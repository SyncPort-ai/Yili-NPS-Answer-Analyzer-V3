# YiLi NPS Insights Hub – Replication Design

Author: AI Agent
Date: 2025-09-10

## Overview
- Goal: Replicate the app’s core functions, page structure ("paging"), side menu, and NPS-focused methodology from `yili-nps-insights-hub` (Vite + React + TypeScript UI generated by Lovable.dev).
- Scope: Mirror routes, layouts (Header + Sidebar), key NPS widgets, tabs, and data views. Prepare back-end data contracts to serve equivalent content from our analyzers (esp. `nps-report-analyzer`).

## Tech Stack (source app)
- Frontend: Vite + React + TypeScript, TailwindCSS, lucide-react icons, shadcn/ui-style component primitives (under `src/components/ui/*`).
- Routing: React Router (`BrowserRouter`, `Routes`, `Route`).
- State/Data: TanStack Query wraps app (no remote API calls in current code; uses mock/static arrays).

Key entry points:
- `src/main.tsx`: React bootstrap.
- `src/App.tsx`: Router + providers.
- Layout: `src/components/layout/Header.tsx`, `src/components/layout/Sidebar.tsx`.
- Dashboard: `src/components/dashboard/*` and `src/pages/Index.tsx`.

## Routes & Menu (to replicate)
Defined in `src/App.tsx` and `src/components/layout/Sidebar.tsx`:
- `/` → `Index` (Dashboard – NPS overview)
- `/projects` → `Projects` (project list/cards)
- `/surveys` → `Surveys` (survey list & metrics)
- `/analytics` → `Analytics` (deep-dive NPS analytics)
- `/insights` → `Insights` (expert + AI insights)
- `/consumers` → `Consumers` (segments & top consumers)
- `/calendar` → `Calendar` (research calendar and upcoming items)
- `/reports` → `Reports` (report center + analytical reports)
- `/settings` → `Settings`

Sidebar items (with collapse/expand):
- NPS概览 `/` (BarChart3 icon)
- 项目管理 `/projects` (Target)
- 问卷设计 `/surveys` (ClipboardList)
- 数据分析 `/analytics` (TrendingUp)
- 专家洞察 `/insights` (Brain)
- 消费者档案 `/consumers` (Users)
- 调研日历 `/calendar` (Calendar)
- 报告中心 `/reports` (FileText)
- 系统设置 `/settings` (Settings)

Header shows product identity, notification, search, user menu.

## NPS Methodology (as implemented in UI)
- Core formula: NPS = %Promoters − %Detractors, where
  - Promoters: respondents scoring 9–10
  - Passives: scoring 7–8
  - Detractors: scoring 0–6
- Dashboard cards (see `NPSMetricCard.tsx` and `components/dashboard/Dashboard.tsx`):
  - Overall NPS (e.g., 68.5)
  - 推荐者比例 (Promoter %)
  - 中性者比例 (Passive %)
  - 贬损者比例 (Detractor %)
  - Cards show deltas vs previous period and trend direction.
- Analytics page (`src/pages/Analytics.tsx`):
  - KPIs: 平均NPS、推荐者比例、中性者比例、贬损者比例.
  - 产品线NPS对比: list of `{ category, nps, change, trend }`.
  - 智能洞察: descriptive items with impact/category badges.
  - Tabs for: 总览 (time-series placeholder), 人群分析 (segment NPS, satisfaction, loyaltyRate, sampleSize), 区域分析 (regional NPS, market share, growth, highlight), 产品分析 (per-product NPS + insights/reco), 预测分析 (AI-style drivers & risks with confidence).
- Reports (`src/pages/Reports.tsx` + `src/data/mockReports.ts`):
  - Report list items with metadata, status badge, actions.
  - Tabs: 报告中心 (list + categories + latest/quick actions), 深度分析 (renders `AnalyticalReport` cards from rich mock schema), 行业洞察, 竞争分析.
- Consumers (`src/pages/Consumers.tsx`):
  - Segments with NPS per segment and attributes.
  - High-value consumers list with NPS score badges.

Takeaways for replication:
- Provide API to compute/serve: overall NPS, promoter/passive/detractor breakdowns, segment/regional/product NPS, trends, plus “insight” text blocks.
- Support drill-down views: per segment, region, product line.
- Present trends and deltas vs previous period.

## Data Shapes to Support (proposed API contracts)
Back-end (`nps-report-analyzer`) should expose endpoints to supply the UI with data structures akin to current mock arrays:

- `GET /nps/summary`
  - `{ nps: number, promoter_pct: number, passive_pct: number, detractor_pct: number, prev: { nps?: number, promoter_pct?: number, ... } }`

- `GET /nps/trends?interval=month&months=12`
  - `[{ period: "2024-01", nps: number, promoter_pct: number, passive_pct: number, detractor_pct: number }]`

- `GET /nps/by-product`
  - `[{ product: string, nps: number, change: number, trend: 'up'|'down'|'neutral' }]`

- `GET /nps/by-segment`
  - `[{ segment: string, nps: number, satisfaction?: number, loyalty_rate?: number, sample_size?: number }]`

- `GET /nps/by-region`
  - `[{ region: string, nps: number, market_share?: number, growth?: string, highlight?: string }]`

- `GET /insights`
  - `[{ title: string, description: string, impact: '高'|'中'|'低', category: string }]`

- `GET /reports`
  - `[{ id, title, description, type, status, date, author, size, pages, downloads, category }]`

- `GET /reports/analytical`
  - Use `src/data/mockReports.ts` model as reference (AnalyticalReport and nested types) to return rich, actionable analytics.

Notes:
- All endpoints should compute NPS from raw scores if provided; accept upload/ingestion of individual responses `{ respondent_id, score (0–10), segment?, region?, product? }`.
- Include prev-period calculations for deltas.

## UI Replication Plan
1) Layout
- Reuse Header + Sidebar structure; implement Sidebar collapse toggle. Keep icons and labels to match navigation.

2) Dashboard `/` (Index)
- Hero banner.
- Four NPS KPI cards (`NPSMetricCard`) showing current values vs previous, with trend icons.
- Project grid (`ProjectCard`) and quick actions + insights.

3) Surveys `/surveys`
- Header with “创建新问卷”.
- Three KPI tiles, list of surveys with status and completion progress bar.

4) Analytics `/analytics`
- KPI row (NPS, promoter, passive, detractor).
- Two-up: 产品线NPS对比 + 智能洞察.
- Tabs: 总览 (time-series), 人群/区域/产品/预测 as per current fields.

5) Reports `/reports`
- KPI tiles, tabs, report list/category filters, and deep analytical sections backed by `AnalyticalReport` schema.

6) Consumers `/consumers`
- Segment cards with NPS + attributes; “高价值用户” list with score badges.

7) Calendar `/calendar`
- KPI tiles; month navigator; upcoming events list.

8) Settings `/settings`
- Settings categories with toggles; system info; integrations; personalization; support; audit trail.

## Paging & Navigation Patterns
- Routing-level "paging": each major section is a route (Sidebar). Within pages, content is partitioned using `Tabs` (e.g., Analytics and Reports).
- No explicit numbered pagination is present in lists; lists are small. When scaling up, add `page`/`limit` and client-side pagination controls on long lists.

## Implementation Details & References
- Router: `src/App.tsx` shows all routes and `NotFound` fallback.
- Sidebar collapse: `src/components/layout/Sidebar.tsx` with `useState(collapsed)`.
- KPI Cards: `src/components/dashboard/NPSMetricCard.tsx` for delta and trend badge logic.
- Mock analytical model: `src/data/mockReports.ts` – adopt as API contract for rich reports.
- Styling: Tailwind utility classes with subtle gradients (`bg-gradient-primary`, `bg-gradient-subtle`) and soft shadows.

## Back-end Alignment (nps-report-analyzer)
- Add endpoints above to compute and serve NPS summaries, breakdowns, trends, and insights.
- Ensure time-window params (e.g., `?from=&to=` or `?months=`) and grouping filters (`segment`, `region`, `product`) are supported.
- Provide consistent field names and typing matching the UI’s expectations to allow drop-in replacement for current mock arrays.

## Screenshots
- Target pages for capture: `/`, `/analytics`, `/surveys`, `/reports`, `/projects`, `/insights`, `/consumers`, `/calendar`, `/settings`.
- Save under `nps-report-analyzer/DOCUMENTS/screenshots/` as `{route}.png` (e.g., `analytics.png`).
- Note: Automated capture via Playwright MCP was unavailable in this environment. We can re-attempt with MCP enabled or capture manually from https://preview--yili-insights-hub.lovable.app/.

## Replication Checklist
- [ ] Implement routes and sidebar to match paths and labels
- [ ] Recreate Header and Dashboard hero
- [ ] Build NPS KPI cards with trend deltas
- [ ] Implement Analytics tabs and sections with charts placeholder
- [ ] Provide Reports center and AnalyticalReport rendering
- [ ] Add Consumers segments + top customers lists
- [ ] Add Calendar KPIs and month navigator
- [ ] Add Settings sections and toggles
- [ ] Wire to `nps-report-analyzer` endpoints; remove mock arrays
- [ ] Capture page screenshots into `DOCUMENTS/screenshots/`

## Appendix – File References (source)
- Routes: `src/App.tsx`
- Layout: `src/components/layout/Header.tsx`, `src/components/layout/Sidebar.tsx`
- Dashboard: `src/components/dashboard/Dashboard.tsx`, `NPSMetricCard.tsx`, `ProjectCard.tsx`, `src/pages/Index.tsx`
- Analytics: `src/pages/Analytics.tsx`
- Surveys: `src/pages/Surveys.tsx`
- Reports: `src/pages/Reports.tsx`, `src/data/mockReports.ts`, `src/components/reports/AnalyticalReport.tsx`
- Consumers: `src/pages/Consumers.tsx`
- Calendar: `src/pages/Calendar.tsx`
- Settings: `src/pages/Settings.tsx`

