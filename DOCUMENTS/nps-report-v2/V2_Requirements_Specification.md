# 伊利NPS洞察智能体 V2.0 需求规格说明书

## 项目概述

基于现有V1版本的成功实现和质量保证机制，V2.0版本将支持双输入模式，处理原始问卷数据和预处理分析结果，同时增强数据质量评估和可信度分析能力。

## 核心改进目标

### 1. 数据质量与可信度增强 ✅ (已完成)
- **数据质量评估框架**: 六维度评估（完整性、有效性、一致性、准确性、时效性、唯一性）
- **可信度计算算法**: 综合统计置信度、响应质量、样本代表性等指标
- **质量保证机制**: 集成到现有的4专家评审系统中

### 2. 双输入模式支持 (V2核心需求)

#### 输入模式A: 原始问卷数据
**数据来源**: Excel格式的调研问卷原始答案
- **系统平台NPS**: `定量智能体-系统平台NPS调研模板_答案文本数据列表_*.xlsx`
- **产品NPS**: `定量智能体-产品NPS调研模板_答案文本数据列表_*.xlsx`

**数据结构特征**:
```json
{
  "样本编码": "string",
  "作答类型": "正式|测试", 
  "AI标记状态": "未标记|已标记",
  "作答状态": "已完成|进行中",
  "答题时间": "YYYY-MM-DD HH:mm:ss",
  "提交时间": "YYYY-MM-DD HH:mm:ss",
  "作答时长": "string",
  "Q1您向同事推荐XXXX的可能性多大？": "0-10分",
  // 系统平台问卷特定字段
  "Q2 您不推荐XXX的原因有哪些？_操作复杂难上手": "选项值|-",
  "Q2 您不推荐XXX的原因有哪些？_界面内容不清晰": "选项值|-",
  "Q2 您不推荐XXX的原因有哪些？_数据帮助不大": "选项值|-",
  "Q6 您推荐XXX的原因有哪些？_功能完善": "选项值|-",
  "Q6 您推荐XXX的原因有哪些？_活动丰富": "选项值|-",
  "Q5您还期待XXX提供哪些方面的内容或数据？": "开放文本",
  "Q3您对XXX还有哪些建议？": "开放文本",
  
  // 产品问卷特定字段
  "Q2 您不愿意推荐我们的主要因素有哪些？_不喜欢喜欢品牌或代言人、赞助综艺等宣传内容": "选项值|-",
  "Q2 您不愿意推荐我们的主要因素有哪些？_包装设计不好": "选项值|-", 
  "Q2 您不愿意推荐我们的主要因素有哪些？_饮用后感觉不舒服": "选项值|-",
  "Q4 您愿意推荐我们的主要因素有哪些？_喜欢品牌或代言人、赞助综艺等宣传内容": "选项值|-",
  "Q4 您愿意推荐我们的主要因素有哪些？_产品口味口感好": "选项值|-",
  "Q3 您不愿意推荐我们的具体原因是什么？": "开放文本",
  "Q5 您愿意推荐我们的具体原因是什么？": "开放文本"
}
```

#### 输入模式B: 预处理分析结果
**数据来源**: 经过初步AI分析的结构化结果

**数据结构**:
```json
{
  "base_analysis_result": "HTML格式的基础分析文本 (包含<br>标签)",
  "cross_analysis_result": "null | HTML格式的交叉分析结果",
  "kano_analysis_result": "null | HTML格式的KANO模型分析结果", 
  "psm_analysis_result": "null | HTML格式的PSM价格敏感度分析结果",
  "maxdiff_analysis_result": "null | HTML格式的MaxDiff分析结果",
  "nps_analysis_result": "HTML格式的NPS专项分析结果"
}
```

**示例数据**:

*系统平台NPS预处理结果*:
```json
{
  "base_analysis_result": "1. 用户不推荐XXX的主要原因：操作复杂难上手、界面内容不清晰、活动单调和数据帮助不大，其中数据帮助不大占比最高（66.67%）。功能难找、性能不稳定等问题未被提及。<br>2. 用户推荐XXX的主要原因：功能完善和活动丰富（各占66.67%），其次是界面清晰易理解、能高效完成任务、性能稳定、界面美观、内容质量高和应用与服务介绍清晰（各占33.33%）。<br>3. 用户最期待XXX改进的内容或数据：信息透明与分类展示（占比62.5%），其次是产品多样性与营养价值优化（占比25%）。<br>4. 用户对XXX的主要建议：使用流程优化建议（占比50%），其次是产品包装与价格优势（占比37.5%）。",
  "nps_analysis_result": "1. NPS值为-0.1111，表明用户整体满意度较低，贬损者比例高于推荐者。 <br>2. 贬损者占比44%，显著高于推荐者（33%）和中立者（22%），说明存在较多不满意的用户。 <br>3. 推荐者（9-10分）和中立者（7-8分）合计占比55%，仍有部分用户对产品或服务持积极或中立态度。 <br>4. 总体来看，用户反馈呈现负面倾向，需重点关注贬损者的不满原因并采取改进措施，以提升整体满意度。"
}
```

*产品NPS预处理结果*:
```json
{
  "base_analysis_result": "1. 营销宣传问题是主要障碍：受访者不愿意推荐产品的首要原因是品牌或代言人、赞助综艺等宣传内容不受喜欢（100%），其次是包装设计不佳（66.67%）。营销宣传策略问题和产品信息获取障碍也是重要因素。 <br>2. 产品体验与功能感知不足：部分受访者因饮用后感觉不舒服（33.33%）或未感知到产品宣传的功能（33.33%）而不愿推荐，表明产品实际体验与宣传存在差距。 <br>3. 推荐动机多元化：愿意推荐产品的受访者动机分散，包括对品牌/宣传内容的喜爱（50%）、性价比高（50%）、促销活动满意（50%）、口味口感好（50%）以及体感舒适（50%）。 <br>4. 产品优势与包装吸引力促进推荐：产品本身的优势与多样性是推荐的主要驱动力（2人），包装外观的吸引力也起到一定作用（1人）。",
  "nps_analysis_result": "1. NPS值为-25%，表明用户整体满意度较低，贬损者比例显著高于推荐者。 <br>2. 贬损者占比50%，远高于推荐者（25%）和中立者（25%），反映出产品或服务存在明显改进空间。 <br>3. 评分为5分（38%）和10分（25%）的用户占比较高，显示用户态度呈现两极分化趋势。 <br>4. 总体来看，当前用户负面情绪占主导，需优先解决贬损者的核心问题，同时关注中立者的潜在转化机会以提升NPS。"
}
```

## V2.0 技术架构设计

### 3. 辅助信息增强系统

V2.0版本集成关键企业辅助信息，大幅提升分析的业务价值和精准度：

#### 3.1 伊利集团企业知识库
**数据来源**: `洞察智能体品类品牌渠道清单.xlsx` 和 `洞察智能体品类品牌渠道清单.json`

**完整企业架构数据**:
```json
{
  "metadata": {
    "total_business_units": 8,
    "total_products": 79, 
    "total_channels": 12
  },
  "business_units": [
    {
      "name": "液奶事业部",
      "categories": ["常温白奶", "成人常温酸奶", "儿童奶", "植物蛋白"],
      "products": [
        {
          "brand_id": 2,
          "brand_name": "金典",
          "category": "常温白奶",
          "product_examples": "金典有机奶、金典娟姗奶、金典超滤牛奶",
          "channel_code": "YILI_APP_3",
          "channel_name": "金典小程序"
        }
      ]
    }
  ]
}
```

**8大事业部完整覆盖**:
- **液奶事业部**: 金典、安慕希、舒化、QQ星、优酸乳、谷粒多、味可滋、植选等
- **婴幼儿营养品事业部**: 金领冠系列、QQ星榛高等  
- **酸奶事业部**: 畅轻、大果粒、每益添、益消等
- **成人营养品事业部**: 欣活、倍畅、轻慕、全聪等
- **冷饮事业部**: 巧乐兹、甄稀、须尽欢、冰工厂等
- **奶酪事业部**: 伊家好奶酪、伊利Pro、牧恩等
- **伊知牛公司**: 牛肉系列产品
- **康益佳公司**: 依宝宠物用品

#### 3.2 三大业务域标签体系

**概念设计标签 (31个维度)**:
```python
概念设计_标签 = [
    "原料天然", "奶源优质", "目标群体", "乳糖不耐", "素食主义", "健身", "颗粒", 
    "蛋白", "脂肪", "0蔗糖", "植物蛋白", "植物", "水果", "口味口感", "卡路里", 
    "益生菌", "维生素", "有机", "功效性", "独特性", "接受度", "高端", "高品质", 
    "时尚潮流", "天然无添加", "年轻活力", "安全信赖", "营养价值感知", "健康", 
    "专业先进", "文案宣传", "品牌关联", "价格", "容量", "爱国", "奥运", "低碳环保", "包装美观"
]
```

**口味设计标签 (21个维度)**:
```python  
口味设计_标签 = [
    "口味", "酸味", "甜味", "奶香味", "果味", "苦味涩味", "异味杂味", "协调度", 
    "余味回味", "口感", "细腻度", "顺滑度", "清新度", "浓稀度流动性", "层次感", 
    "醇厚度", "添加剂", "颗粒口感", "小料口感", "营养价值感知"
]
```

**包装设计标签 (13个维度)**:
```python
包装设计_标签 = [
    "字体美观度", "字体大小", "字体颜色", "图案美观度", "图案风格", "色彩美观度", 
    "整体美观度", "信息传达", "文案内容", "品牌认知", "产品印象", "情感共鸣", 
    "瓶体", "瓶口瓶盖", "配件", "容量"
]
```

#### 3.3 小程序渠道映射体系

**12个核心数字化触点**:
```json
{
  "mini_program_channels": [
    {"channel_code": "YILI_APP_11", "channel_name": "活力伊利小程序", "description": "综合平台"},
    {"channel_code": "YILI_APP_2", "channel_name": "安慕希小程序", "description": "安慕希专属"},
    {"channel_code": "YILI_APP_3", "channel_name": "金典小程序", "description": "金典专属"},
    {"channel_code": "YILI_APP_21", "channel_name": "金领冠福利站小程序", "description": "婴幼儿营养品"},
    {"channel_code": "YILI_APP_12", "channel_name": "低温会员福利社小程序", "description": "酸奶事业部"},
    {"channel_code": "YILI_APP_20", "channel_name": "巧乐兹小程序", "description": "巧乐兹专属"}
  ]
}
```

### 4. 双输入模式处理架构

#### 4.1 辅助信息集成架构
```python
class AuxiliaryDataManager:
    """辅助信息管理器 - V2版本核心增强"""
    
    def __init__(self, yili_catalog_path: str):
        """加载伊利集团完整产品目录和标签体系"""
        
    def identify_business_context(self, text_content: str, metadata: Dict) -> BusinessContext:
        """从文本和元数据中识别业务上下文 (事业部/品类/品牌/渠道)"""
        
    def analyze_business_domain_tags(self, text_content: str) -> List[TagAnalysisResult]:
        """分析三大业务域标签: 概念设计/口味设计/包装设计"""
        
    def enrich_analysis_with_context(self, analysis_results: Dict) -> Dict:
        """使用企业知识库丰富分析结果"""
```

#### 4.2 输入检测与路由层
```python
class InputModeDetector:
    """智能检测输入数据类型并路由到相应处理器"""
    
    def detect_input_mode(self, data: Dict) -> str:
        """
        检测输入数据模式
        Returns: "raw_questionnaire" | "preprocessed_analysis"
        """
        
    def route_to_processor(self, data: Dict, mode: str) -> Dict:
        """根据模式路由到对应处理器"""
```

#### 4.3 原始问卷数据处理器
```python
class RawQuestionnaireProcessor:
    """处理Excel格式的原始问卷数据"""
    
    def __init__(self):
        self.questionnaire_types = {
            "system_platform": SystemPlatformQuestionnaireAnalyzer(),
            "product": ProductQuestionnaireAnalyzer()
        }
    
    def detect_questionnaire_type(self, data: Dict) -> str:
        """基于字段名检测问卷类型"""
        
    def process_raw_data(self, data: Dict) -> Dict:
        """处理原始问卷数据转换为标准分析格式"""
```

#### 4.4 预处理结果处理器  
```python
class PreprocessedAnalysisProcessor:
    """处理已分析的结构化结果数据"""
    
    def parse_html_analysis(self, html_text: str) -> Dict:
        """解析HTML格式的分析结果"""
        
    def extract_insights(self, analysis_data: Dict) -> Dict:
        """从预处理结果中提取关键洞察"""
        
    def enhance_with_quality_assessment(self, data: Dict) -> Dict:
        """为预处理结果增加质量评估"""
```

### 5. 统一数据质量保证体系

#### 5.1 质量评估扩展
- **原始数据质量**: 问卷完整性、响应有效性、逻辑一致性
- **预处理结果质量**: 文本结构完整性、分析深度、洞察可信度
- **跨模式质量对比**: 不同输入模式结果的一致性验证
- **业务上下文质量**: 品牌识别准确性、标签匹配相关性

#### 5.2 可信度计算增强
```python
def calculate_enhanced_reliability(self, data: Dict, input_mode: str) -> ReliabilityMetrics:
    """
    基于输入模式计算增强的可信度指标
    
    Args:
        data: 输入数据
        input_mode: "raw_questionnaire" | "preprocessed_analysis"
        
    Returns:
        增强的可信度指标，包含模式特定的评估
    """
```

### 6. 输出格式统一 (含辅助信息增强)

无论输入模式如何，V2.0都将产生统一的输出格式：

```json
{
  "input_mode": "raw_questionnaire | preprocessed_analysis",
  "questionnaire_type": "system_platform | product | unknown",
  "data_quality_assessment": {
    "质量维度评分": {...},
    "可信度指标": {...},
    "质量总结": {...}
  },
  "nps_analysis": {
    "nps_score": "number",
    "score_breakdown": {...},
    "distribution_analysis": {...}
  },
  "qualitative_analysis": {
    "key_themes": [...],
    "sentiment_analysis": {...},
    "recommendation_drivers": {...},
    "detractor_reasons": {...}
  },
  "business_insights": {
    "strategic_recommendations": [...],
    "priority_actions": [...],
    "market_implications": {...}
  },
  "business_context": {
    "事业部": "液奶事业部",
    "品类": "成人常温酸奶", 
    "品牌": "安慕希",
    "渠道": "安慕希小程序",
    "渠道编码": "YILI_APP_2",
    "产品示例": "安慕希AMX酸奶、安慕希益生菌酸奶"
  },
  "business_domain_analysis": {
    "概念设计": {
      "匹配标签": ["高端", "高品质", "营养价值感知", "益生菌"],
      "标签数量": 4,
      "相关性分数": {"高端": 0.9, "高品质": 0.8},
      "业务洞察": ["概念设计维度表现丰富", "健康营养概念突出"]
    },
    "口味设计": {
      "匹配标签": ["口味", "口感", "细腻度", "醇厚度"],
      "标签数量": 4,
      "业务洞察": ["口味设计关注度较高"]
    },
    "包装设计": {
      "匹配标签": ["整体美观度", "品牌认知"],
      "标签数量": 2,
      "业务洞察": ["包装设计评价维度有限"]
    }
  },
  "comprehensive_business_insights": [
    "本次分析聚焦于液奶事业部的安慕希品牌",
    "产品类型为成人常温酸奶，属于液奶事业部核心业务",
    "三大业务域共识别10个相关标签，分析维度较为全面",
    "概念设计维度表现最为突出，共涉及4个关键要素",
    "基于安慕希小程序的数字化触点反馈，体现线上用户体验偏好"
  ],
  "enhanced_reporting": {
    "executive_summary": "string",
    "detailed_findings": {...},
    "interactive_visualizations": {...}
  },
  "metadata": {
    "processing_timestamp": "ISO string",
    "analysis_version": "2.0",
    "quality_assurance_score": "number",
    "reliability_level": "高度可信 | 基本可信 | 谨慎可信 | 低可信度",
    "business_context_enriched": true,
    "business_domain_tags_analyzed": true,
    "yili_catalog_version": "1.0"
  }
}
```

## 实施计划

### 阶段1: 基础架构 ✅ (已完成)
- [x] 数据质量评估框架实现
- [x] 可信度计算算法开发  
- [x] 现有质量保证机制集成

### 阶段2: 辅助信息集成 ✅ (已完成)
- [x] 辅助信息管理模块 (`auxiliary_data_manager.py`)
- [x] 伊利集团企业知识库集成
- [x] 三大业务域标签体系实现
- [x] 业务上下文识别和标签分析算法

### 阶段3: 双输入模式开发 (当前阶段)
- [ ] 输入检测与路由层实现
- [ ] 原始问卷数据处理器开发
- [ ] 预处理结果处理器开发
- [ ] 问卷类型识别算法

### 阶段4: 质量保证增强
- [ ] 跨模式质量验证机制
- [ ] 输入模式特定的评审规则
- [ ] 统一输出格式标准化
- [ ] 辅助信息质量评估

### 阶段5: 测试与优化
- [ ] 双输入模式端到端测试
- [ ] 辅助信息集成验证
- [ ] 质量保证机制验证
- [ ] 性能优化和错误处理完善

## 技术约束与兼容性

### Python兼容性要求
遵循全局指令：**内存最小化变更，最大兼容性，确保在Python3上运行，不进行重大升级**

### 现有系统集成
- 与V1版本FastAPI服务保持API兼容
- 复用现有LangGraph多智能体架构
- 保持现有HTML报告生成能力
- 兼容现有企业微信和Dify平台集成

### 数据隐私与安全
- 自动PII检测和脱敏处理
- 中文个人信息识别模式
- 数据传输加密和存储安全
- 符合伊利集团数据治理要求

## 预期效果

### 功能增强
1. **输入灵活性**: 支持原始问卷和预处理结果两种输入模式
2. **质量保证**: 六维度数据质量评估和可信度分析
3. **分析深度**: 针对不同问卷类型的专项分析能力
4. **业务价值**: 更准确的战略洞察和行动建议
5. **企业知识库**: 伊利8大事业部、79个产品、12个渠道的完整映射
6. **标签体系**: 三大业务域65个专业标签的智能识别和分析
7. **上下文增强**: 基于品牌、品类、渠道的精准业务上下文识别

### 系统可靠性
1. **数据质量**: 全面的质量评估和风险提示
2. **分析可信度**: 基于多维指标的可信度计算
3. **结果一致性**: 跨输入模式的质量验证机制
4. **错误处理**: 健壮的异常处理和降级机制

---

*文档版本: V2.0*  
*更新时间: 2025年09月10日*  
*维护团队: 伊利-阿里智能体项目组*