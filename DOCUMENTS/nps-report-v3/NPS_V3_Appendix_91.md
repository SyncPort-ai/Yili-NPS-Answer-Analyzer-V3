# 附录 9.1 《NPS V3 多智能体设计与实现说明书》

## 1. 总体原则
- **分层架构**：Foundation (底座)、Analysis (分析)、Consulting (咨询)。  
- **避免过度解读**：文本类洞察可多一些，战略类洞察 ≤3 条。  
- **可信度计算**：结合样本量与有效率，新增 Medium-High 分级。  
- **动态题序**：通过题干语义识别 Q2/Q3/Q4/Q5，而非固定顺序。  
- **LangGraph 分阶段执行**：拆分子图，避免 token 溢出。  

## 2. 底座层智能体
- **A0 数据预处理员**：标准化答卷、无效回答过滤。  
- **A1 NPS 计算员**：输出推荐/中性/贬损分布与 NPS 值。  
- **A2 样本可信度审查员**：分级 high/medium/low/medium-high。  
- **A3 数据质量监控员**：输出数据完整性与缺口。  

## 3. 分析层智能体
- **B1 推荐者洞察员**：总结推荐动因，生成 1–4 条建议。  
- **B2 中性者洞察员**：输出转化杠杆点，1–3 条建议。  
- **B3 贬损者洞察员**：总结痛点，输出 1–3 条改进建议。  
- **B4 文本聚类分析员**：主题+情感聚类，生成推荐/贬损词云。  
- **B5 驱动因子分析员**：生成重要性 vs 满意度矩阵。  
- **B6 维度对比分析员**：输出产品/地域/触点/人群洞察。  
- **B7 趋势分析员**：输出同比/环比趋势；无数据时提示“暂无趋势”。  
- **B8 竞品对比分析员**：输出对标结果；无数据时提示“暂无对标”。  
- **B9 分析汇总协调员**：去重、排序、加权，合并 B1–B8 洞察。  

## 4. 咨询层智能体
- **C1 战略顾问**：长期战略建议 (1–3 条)。  
- **C2 产品与体验顾问**：短期可执行建议 (1–4 条)。  
- **C3 市场与品牌顾问**：品牌/市场建议 (1–3 条)。  
- **C4 风险与合规顾问**：风险预警与缓解方案 (1–3 条)。  
- **C5 总结协调官**：执行摘要 (5–7 条)，并生成复盘建议。  

## 5. 提示词 (Prompts) 样例

### B4 文本聚类分析员
```
任务：对输入文本进行主题与情感识别。  
乳品场景 → {口感, 包装, 价格, 健康, 创新, 服务}  
系统场景 → {易用性, 界面, 性能, 功能, 服务}  
不在列表的 → “新兴话题”。  
输出：主题+情感分布、典型原话、基于主题的词云。
```

### C2 产品与体验顾问
```
任务：结合推荐/贬损动因与驱动矩阵，提出 1–4 条短期动作。  
要求：每条包含目标、责任方、时间窗口 (如 4–8 周)。  
若可信度=low → 只输出补数/试点建议。
```

## 6. LangGraph 执行策略
- **顺序**：A0 → A1 → A2 → A3 → (B1–B8 并行) → B9 → (C1–C4 并行) → C5。  
- **错误与警告**：写入全局 `warnings/errors`，在 HTML 报告的“数据质量”部分展示。  

## 7. 可信度判定优化
- Low：有效样本 <30 或有效率 <30%。  
- Medium：30–99，或 100–149 有效率 <70%。  
- High：≥150 且有效率 ≥70%。  
- Medium-High：100±20 样本，有效率 ≥60%。  

## 8. 报告交付
- **JSON**：结构化结果，含洞察、可信度、错误。  
- **HTML**：Tailwind 单页，自包含，支持展开/收起模块。  

---
