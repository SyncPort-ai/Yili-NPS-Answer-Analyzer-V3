# NPS V3 报告设计说明书 (初稿)

**作者**：产品设计负责人 / NPS 工具专家  
**版本**：v0.1  
**日期**：2025-09-23  

---

## 1. 背景与目标

- 现有 V2 基于七智能体架构，能输出基础 NPS 报告【84†source】。  
- 存在的问题：固定题号假设、未覆盖中性者、缺少可信度校验、缺乏多维度/战略洞察【83†source】【86†source】。  
- V3 目标：  
  - 构建 **输入 → 多智能体分析 → 洞察合成 → 报告输出** 的全链路体系【88†source】。  
  - 提供结构化 JSON + 单文件 HTML。  
  - 报告既满足管理层“一眼看懂”的需求，也能展开详细分析。  
  - 引入 **可信度分级** 和 **复盘建议**，避免 AI 幻觉。  

---

## 2. 报告受众与使用场景

- **管理层 (60–80%)**：关注战略摘要与重点建议。  
- **品牌/市场负责人**：洞察推荐/贬损动因，调整策略。  
- **客服与体验团队**：接收贬损者预警，闭环改进。  
- **数据分析师**：管理标签与配置，复盘质量与趋势。  

场景：月度/季度报告、专项新品反馈、系统体验调研。  

---

## 3. 输入与数据处理

### 3.1 输入格式
- **根对象**：`yili_survey_data_input` (兼容 V2 格式)【84†source】。  
- **关键字段**：Q1 打分 (0–10)，Q2/Q4 多选题，Q3/Q5 开放题，元信息 (产品/地域/渠道/人群)。  
- **动态题序识别**：不能依赖固定 Q2/Q3/Q4/Q5，需通过题干语义判断【83†source】。  

### 3.2 数据预处理
- 数值化 Q1 (e.g. "5分" → 5)。  
- 识别无效回答 (如“无”“不知道”)【85†source】。  
- 样本量与有效率统计。  

### 3.3 可信度分级
- Low：有效样本 <30，或有效率 <40%。  
- Medium：30–99，或有效率 40–70%。  
- High：≥100 且有效率 ≥70%。  
- 报告中需提示：“⚠️ 本结论基于 {有效样本数}/{总样本数}，仅供参考”。  

---

## 4. 多智能体架构

### 4.1 分层设计
1. **底座层 (Foundation)**：数据预处理、NPS 计算、可信度校验、质量监控。  
2. **分析层 (Analysis)**：推荐者/中性者/贬损者洞察、文本聚类、驱动因子、维度对比、趋势占位、竞品占位。  
3. **咨询层 (Consulting)**：战略顾问、产品体验顾问、市场品牌顾问、风险合规顾问、总结协调官。  

### 4.2 智能体分工
详见补充文档《NPS V3 多智能体设计与实现说明书》【86†source】。  
关键点：  
- 文本类可多产出，战略类严控数量 (≤3)。  
- C5 总结协调官统一收敛，执行摘要 ≤7 条。  
- 当可信度 = Low 时，限制产业/战略结论，强制输出复盘建议。  

### 4.3 LangGraph 执行策略
- 拆分为 A/B/C 三子图，分批运行，避免 token 溢出。  
- 汇总节点负责合并与权重排序。  

---

## 5. 报告结构 (HTML + JSON)

### 5.1 HTML 模板 (单文件，自包含，Tailwind)【89†source】
- **封面**：标题、生成时间、样本量、可信度。  
- **执行摘要**：精选 5–7 条战略/执行建议 (短期+长期)。  
- **核心指标**：NPS 值、推荐/中性/贬损者分布。  
- **驱动因子矩阵**：重要性 vs 满意度。  
- **开放题分析**：主题聚类 + 情感分布；推荐者 vs 贬损者词云 (基于主题词)。  
- **多维度分析**：产品、地域、触点、人群 (缺失则显示“暂无数据”)。  
- **战略洞察**：C1–C4 输出，带行动建议。  
- **复盘建议**：如“扩大样本/增加地域/丰富触点”。  
- **附录**：数据质量报告、方法论说明。  

### 5.2 JSON 输出结构
```json
{
  "metadata": { "generated_at": "...", "confidence": { "level": "medium", "sample_size": 84 } },
  "kpi": { "nps": -12.5, "bands": { "promoter_pct": 0.29, "passive_pct": 0.34, "detractor_pct": 0.37 } },
  "insights": { "level2": [...], "level3": [...], "exec_summary": [...] },
  "driver_matrix": { "points": [...] },
  "dimensions": { "product": {...}, "region": {...}, "touchpoint": {...}, "persona": {...} },
  "text_analysis": { "clusters": [...], "wordcloud": {...} },
  "quality": { "notes": [...], "warnings": [...], "errors": [] }
}
```

---

## 6. 错误与风险管理

- **输入错误**：缺少必填字段 → `INPUT_SCHEMA_ERROR`。  
- **样本不足**：触发 `INSUFFICIENT_SAMPLE_WARNING`。  
- **极端分布**：触发 `SKEWED_DISTRIBUTION_WARNING`。  
- **文本无效率高**：触发 `TEXT_QUALITY_WARNING`。  
- **维度缺失**：触发 `DIMENSION_DATA_GAP`。  
- **行业缺失**：触发 `BENCHMARK_MISSING`。  

---

## 7. 工程实现与交付

### 7.1 技术栈
- Python + FastAPI (API V3 + Portal)  
- Tailwind (HTML 单页报告)  
- LangGraph (多智能体编排)  
- 内部库优先 (参考 V2 clean architecture【87†source】)  

### 7.2 API 定义
`POST /nps_report_v3`  
- 输入：V2 兼容 JSON【84†source】  
- 输出：JSON + HTML(base64)  

### 7.3 交付节奏
- **MVP (2–3 周)**：NPS计算、推荐/中性/贬损者分析、文本聚类、执行摘要、可信度提示。  
- **增强 (后续)**：驱动因子矩阵、维度对比、战略顾问层、趋势/对标模块。  

---

## 8. 推荐设计工作流

1. **文档化**：完成 V3 设计说明书 (本文件 + 多智能体补充文档)。  
2. **原型验证**：用小样本数据生成 demo HTML + JSON，收集反馈。  
3. **工程交付**：编写 `schemas.py`、`graph.py`、`api_v3.py`、`report_template.html`。  
4. **测试与迭代**：单元测试 + 集成测试 (小样本/极端场景/缺维度)。  
5. **业务复盘**：引入用户反馈，优化智能体权重与提示词配置。  

---

## 9. 附录

- 《NPS V3 多智能体设计与实现说明书》 (详细角色定义与 Prompts)  
- 《NPS 方法论回顾与AI扩展》【86†source】  
- 《伊利智能 NPS 平台设计》【88†source】  
- V2 API 文档【84†source】  
- 开放文本分析接口文档【85†source】  
- Demo HTML 报告【89†source】  

---

**结论**：V3 报告设计兼顾 **稳健性 (可信度约束、复盘建议)** 与 **商业价值 (战略顾问、执行摘要)**，通过分层多智能体架构与单文件 HTML 交付，既能满足高管快速决策，也能支持业务团队深入分析。

