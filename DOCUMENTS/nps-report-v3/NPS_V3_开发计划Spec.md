# NPS V3 开发计划

基于对V3设计文档的深度分析，制定以下详细开发计划：

## 📋 核心架构概览

### 技术栈
- **后端**: Python + FastAPI + LangGraph + Pydantic
- **前端**: Tailwind CSS (单文件HTML)
- **AI**: 多智能体架构 (14个专业Agent)
- **兼容性**: 保持V2 API向下兼容

### 三层智能体架构
```
Foundation Layer (A0-A3): 数据预处理、NPS计算、可信度评估、质量监控
Analysis Layer (B1-B9): 三群体洞察、文本聚类、驱动因子、维度对比、趋势分析
Consulting Layer (C1-C5): 战略顾问、产品顾问、市场顾问、风险顾问、总结协调
```

## 🚀 第一阶段：原型与验证 (2-3周)

### 目标
用小样本跑出第一版Demo (JSON + HTML)，验证核心工作流

### 工程师任务分工

#### 后端工程师 (核心开发)
**Week 1: 基础架构**
- [ ] 构建 `schemas.py` - 定义V3输入输出模型（兼容V2）
- [ ] 实现 `foundation_agents.py` - A0-A3底座层智能体
- [ ] 开发动态题序识别算法 - 语义识别Q2/Q3/Q4/Q5
- [ ] 建立可信度分级机制 - 新增Medium-High分级

**Week 2: 多智能体核心**
- [ ] 实现 `analysis_agents.py` - B1-B9分析层智能体
- [ ] 实现 `consulting_agents.py` - C1-C5咨询层智能体
- [ ] 构建 `langgraph_workflow.py` - 分批执行策略
- [ ] 集成错误与警告机制 - 6种错误类型处理

**Week 3: API与集成**
- [ ] 开发 `api_v3.py` - POST /nps_report_v3端点
- [ ] 接入开放文本分析接口 - 聚类+情感+无效样本识别
- [ ] 实现JSON+HTML双格式输出
- [ ] V2/V3双路由兼容性测试

#### 前端/可视化工程师
**Week 1-2: HTML模板开发**
- [ ] 设计Tailwind CSS单文件模板
- [ ] 实现响应式指标卡片 (NPS值、分布、可信度)
- [ ] 开发执行摘要模块 (5-7条关键建议)
- [ ] 构建驱动因子矩阵可视化

**Week 3: 交互与优化**
- [ ] 实现折叠/展开交互模块
- [ ] 开发词云组件 (推荐者vs贬损者)
- [ ] 集成多维度分析展示区
- [ ] 添加学习中心/Portal跳转按钮

#### 测试数据准备
- [ ] 收集6-10份真实测试数据（包含边界案例）
- [ ] 准备小样本(<30)、中样本(~100)、大样本(≥300)场景
- [ ] 构建极端分布测试用例（全0分、全10分、高度集中）

### 验证目标
- [ ] 输出单文件HTML报告
- [ ] 验证执行摘要质量（5-7条）
- [ ] 确认可信度提示正确性
- [ ] 检查洞察数量合理性（避免过度解读）

## 🔧 第二阶段：工程实现完善 (3-4周)

### 后端工程师深化
**提示词工程优化**
- [ ] 精调14个Agent的Prompt模板
- [ ] 实现行业场景适配（乳制品vs系统平台）
- [ ] 优化中文文本处理和情感分析
- [ ] 建立Agent输出质量控制机制

**性能与稳定性**
- [ ] LangGraph分批执行优化 - 避免token溢出
- [ ] 实现请求级错误恢复机制
- [ ] 添加异步处理和超时控制
- [ ] 建立结果缓存策略

**数据管理**
- [ ] 完善持久化知识管理系统
- [ ] 实现业务规则动态配置
- [ ] 建立分析结果归档机制
- [ ] 集成反馈迭代数据收集

### 架构师责任
**系统集成**
- [ ] 确保V2与V3完全兼容性
- [ ] 优化内部库调用，最小化API暴露
- [ ] 建立监控和日志系统
- [ ] 实现负载均衡和扩容策略

**安全与合规**
- [ ] 实现PII数据脱敏处理
- [ ] 建立访问控制和审计日志
- [ ] 确保企业级安全标准
- [ ] 建立数据备份和恢复机制

## 🧪 第三阶段：测试与质量保障 (2-3周)

### 测试工程师测试矩阵

#### 输入验证测试
- [ ] 必填字段缺失场景
- [ ] 无效JSON格式处理
- [ ] 极端数值输入测试
- [ ] 字符编码兼容性测试

#### 样本场景测试
- [ ] **Low样本**: <30有效样本 - 确认仅输出复盘建议
- [ ] **Medium样本**: 30-99样本 - 验证中等可信度标记
- [ ] **Medium-High样本**: 100±20且有效率≥60% - 新增分级测试
- [ ] **High样本**: ≥150且有效率≥70% - 完整洞察输出

#### 文本场景测试
- [ ] 开放题全是"无"/"不知道" - TEXT_QUALITY_WARNING
- [ ] 高度一致文本 - 聚类算法有效性
- [ ] 极端多样化文本 - 主题识别准确性
- [ ] 混合中英文文本处理

#### 风险场景测试
- [ ] NPS全部0分/全部10分 - SKEWED_DISTRIBUTION_WARNING
- [ ] 维度数据完全缺失 - DIMENSION_DATA_GAP
- [ ] 竞品对标数据缺失 - BENCHMARK_MISSING
- [ ] 历史趋势数据缺失处理

#### 持续集成(CI)
- [ ] 单元测试覆盖率 ≥ 85%
- [ ] 集成测试 - V2/V3双通道
- [ ] Smoke test - 端到端工作流
- [ ] 性能测试 - 响应时间<30秒

## 👥 第四阶段：业务验证与复盘 (2-3周)

### 伊利管理层验证
- [ ] **执行摘要可读性** - 确认≤1页格式
- [ ] **战略洞察质量** - 验证对决策支持价值
- [ ] **可信度提示清晰度** - 避免过度解读风险
- [ ] **多维度分析实用性** - 产品/地域/人群洞察

### 伊利一线团队验证
- [ ] **Verbatim展示效果** - 原始反馈呈现质量
- [ ] **词云可视化价值** - 推荐者vs贬损者对比
- [ ] **驱动因子矩阵实用性** - 重要性vs满意度矩阵
- [ ] **行动建议可执行性** - 短期建议的可操作性

### 客户经理验证
- [ ] **复盘会议支持** - 报告在会议中的使用效果
- [ ] **学习中心集成** - Portal跳转功能验证
- [ ] **报告传播便利性** - HTML/PDF格式适用性
- [ ] **问题解答支持** - 技术问题响应能力

### 反馈收集与优化
**若反馈"太多/太散"**:
- [ ] 调整洞察数量权重 (战略类≤3条，文本类适度)
- [ ] 优化C5总结协调官的收敛算法
- [ ] 强化可信度约束机制

**若反馈"缺乏行动性"**:
- [ ] 强化C2产品顾问的提示词 (责任方+时间窗口)
- [ ] 增强短期建议的具体性和可执行性
- [ ] 添加ROI估算和优先级排序

## 🚀 第五阶段：未来增强规划

### Phase 2 (3-4个月)
- [ ] **PDF导出功能** - 企业级报告格式
- [ ] **前端Dashboard** - 月度趋势、团队对比可视化
- [ ] **战略顾问层全面上线** - C1-C4完整功能
- [ ] **移动端适配** - 响应式设计优化

### Phase 3 (6-12个月)
- [ ] **行业对标数据接入** - 与蒙牛等竞品对比
- [ ] **趋势预测模型** - 基于历史数据的AI预测
- [ ] **自适应问卷** - AI动态调整问题序列
- [ ] **智能问卷设计助手** - 自动生成最优问卷结构

## 📊 关键成功指标 (KPI)

### 技术指标
- **响应时间**: API调用 < 30秒
- **准确率**: 文本聚类准确率 ≥ 85%
- **可用性**: 系统可用性 ≥ 99.5%
- **兼容性**: V2 API 100%兼容

### 业务指标
- **用户满意度**: 伊利团队评分 ≥ 8.0/10
- **报告质量**: 专家评审通过率 ≥ 90%
- **学习中心使用率**: 月活跃用户增长 ≥ 25%
- **决策支持价值**: 管理层认可度 ≥ 85%

## 🎯 建议优先行动

### 立即启动 (本周)
1. **组建开发团队** - 2名后端 + 1名前端 + 1名测试
2. **环境搭建** - 开发/测试/生产环境配置
3. **数据准备** - 收集6-10份测试样本
4. **技术选型确认** - LangGraph版本、依赖库版本锁定

### 第一个冲刺 (2周内)
1. **MVP版本交付** - NPS计算、三群体分析、基础HTML报告
2. **内部演示** - 产品经理和测试工程师审阅
3. **客户预览** - 伊利客户经理小范围试用
4. **反馈收集** - 直观使用体验和改进建议

### 风险控制措施
- **技术风险**: 设立每周技术评审，及时发现架构问题
- **进度风险**: 采用敏捷开发，2周一个迭代交付
- **质量风险**: 建立测试驱动开发(TDD)，自动化测试覆盖
- **业务风险**: 保持与伊利团队密切沟通，快速响应需求变化

## 🎯 **学习中心集成战略**
- HTML报告内置Portal跳转按钮，形成"分析→学习→复盘"闭环
- 帮助伊利团队从机械实施转向深度理解NPS价值
- 支持高层管理层与一线团队的分层学习和协同

## 🏗️ **架构创新点**
- **三层14智能体** - 比V2的7智能体更专业化分工
- **动态题序识别** - 不依赖固定Q2/Q3/Q4/Q5，适应性更强
- **可信度分级优化** - 新增Medium-High分级，更精准指导决策
- **LangGraph分批执行** - 避免token溢出，提升稳定性

## 📊 **质量保障体系**
- **6种错误类型** - 从输入验证到分布偏倚的全覆盖
- **4种样本场景测试** - Low/Medium/Medium-High/High的分级验证
- **CI/CD自动化** - 单元测试+集成测试+性能测试

## 🚀 **快速启动建议**
建议优先实施第一阶段的MVP版本，用6-10份测试数据快速验证核心工作流，然后基于伊利团队反馈迭代优化。这样既能快速看到成果，又能确保产品符合实际业务需求。

整个计划预计12-16周完成核心功能，后续可根据业务发展需要逐步增强功能。

---

**作者**: 产品规划团队
**版本**: v1.0
**日期**: 2025-09-23
**关联文档**: NPS_V3_Report_Design_Spec_v2.1.md, NPS_V3_MultiAgent_Design.md