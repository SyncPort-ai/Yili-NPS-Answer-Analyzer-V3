import pandas as pd


# aspect_dict={
#     '概念设计': '目标群体_乳糖不耐、目标群体_健身、目标群体_控糖、目标群体、口味_口感、口味_风味、口味_果酱&果粒、口味、成分营养_蛋白质、成分营养_脂肪、成分营养_0蔗糖、成分营养_0乳糖、成分营养_植物蛋白、成分营养_卡路里、成分营养_益生菌、成分营养_维生素、成分营养_有机、成分营养、功效性、产品感知_独特性、产品感知_接受度、产品感知_高端、产品感知_高品质、产品感知_时尚潮流、产品感知_健康养生、产品感知_年轻活力、产品感知_安全信赖、产品感知_专业先进、产品感知、文案宣传、品牌关联、概念认知、价格、容量、文化趋势_爱国、文化趋势、社会趋势_环保、社会趋势',
#     '口味设计': '酸味、甜味、苦味&涩味、奶香味、水果味、异味&杂味、协调度&自然度、酸甜协调度、甜味奶味协调度、酸味奶味协调度、水果味奶味协调度、余味回味、余味回味甜度、余味回味酸度、奶香存留度、细腻度、顺滑度、浓稀度&流动性、层次感、醇厚度、颗粒_软硬度、颗粒_大小、颗粒_咀嚼体验',
#     '包装设计': '包装设计_美观协调、包装设计_适合产品、包装设计_便携性、包装设计、品牌_醒目、品牌、图案_大小、图案_色彩、图案_美观度、图案、文字_大小、文字_色彩、文字_信息传达、文字_字体、文字、产品感知_差异化、产品感知_高端、产品感知_高品质、产品感知_时尚潮流、产品感知_健康养生、产品感知_年轻活力、产品感知_安全信赖、产品感知_专业先进、产品感知_营养丰富、产品感知_原料优质、产品感知_适合送礼、产品感知_奶源优质、产品感知'}

aspect_dict={
    '概念设计': '原料天然、奶源优质、目标群体、乳糖不耐、素食主义、健身、颗粒、蛋白、脂肪、0蔗糖、植物蛋白、植物、水果、口味口感、卡路里、益生菌、维生素、有机、功效性、独特性、接受度、高端、高品质、时尚潮流、天然无添加、年轻活力、安全信赖、营养价值感知、健康、专业先进、文案宣传、品牌关联、价格、容量、爱国、奥运、低碳环保、包装美观',
    '口味设计': '口味、酸味、甜味、奶香味、果味、苦味涩味、异味杂味、协调度、余味回味、口感、细腻度、顺滑度、清新度、浓稀度流动性、层次感、醇厚度、添加剂、颗粒口感、小料口感、营养价值感知',
    '包装设计': '字体美观度、字体大小、字体颜色、图案美观度、图案风格、色彩美观度、整体美观度、信息传达、文案内容、品牌认知、产品印象、情感共鸣、瓶体、瓶口瓶盖、配件、容量'}

# sample_dict={
    
# '概念设计_喜欢':f"""
# 示例输入：
# 回答：看起来比较高品质，比较天然
# 回答：口感会更醇厚，饱腹感强
# 示例输出：
# （高品质，高品质）|（天然无添加，天然）@（口味口感，口感醇厚）|（功效性，饱腹感强）
# """,
    
# '概念设计_不喜欢':f"""
# 示例输入：
# 回答：如果不含牛乳会影响口感奶香味，营养也会不全面
# 回答：不知道这个AMX代表什么意思
# 示例输出：
# （口味口感，不含牛乳影响口感和奶香味）|（成分营养，不含牛乳营养不全面）@（文案宣传，AMX含义不明）
# """,

# '口味设计_喜欢':f"""示例输入：
# 回答：口感浓郁（口感比较粘稠，酸奶口感，因为好喝）
# 回答：甜度适中，醇厚感不错，余味不反酸
# 示例输出：
# （浓稀度流动性，口感浓郁酸奶口感）@（甜味，甜度适中）|（醇厚度，醇厚感不错）|（余味回味，余味不反酸）
# """,

# '口味设计_不喜欢':f"""示例输入：
# 回答：刚入口太甜了，并伴随短暂的刺激性香味在舌尖弥漫（酸奶入口应该是清爽的，但这款有轻微的味觉刺激，感觉不舒服）甜味素的回味感（甜味素太多了，我个人不是很喜欢来自化学感的甜味，更喜欢蔗糖果糖的甜味）
# 回答：小料的甜味不甜，就是单纯胶质的口感品尝出来味道
# 示例输出：
# （甜味，入口太甜）|（异味杂味，刺激性香味）|（添加剂，甜味素太多有化学感）@（小料口感，小料不甜）@（小料口感，小料胶质感）
# """,
# '包装设计_喜欢':f"""示例输入：
# 回答：字体非常好看；配色比较的让人舒服；配图干净
# 回答：字大清晰可见，一眼看到有益生菌（益生菌，安慕希品牌）
# 示例输出：
# （字体美观度，字体好看）|（色彩美观度，配色舒服）|（图案美观度，配图干净）@（字体美观度，字大清晰可见）|（文案内容，一眼看到有益生菌）|（品牌认知，安慕希品牌明显）
# """,

# '包装设计_不喜欢':f"""示例输入：
# 回答：字太多，很烦跟益生菌挂钩，包装视觉冲击力弱，画面老土，全是��字，抓不住购买欲望
# 回答：白色和蓝色的搭配比例，蓝色太多了（感觉比例失调）
# 示例输出：
# （文案内容，字太多）|（文案内容，跟益生菌挂钩）|（整体设计美观度，包装视觉冲击力弱）|（整体设计美观度，画面老土）|（情感共鸣，抓不住购买欲）@（色彩美观度，蓝色太多比例失调）
# """
# }


# def prompt_create(theme,emotion,answer):
#     tendency = '正向' if emotion == "喜欢" else "负向"
#     #appendix = "还未投产，进针对新提出的产品概念" if theme=='概念设计' else ""
#     theme_emotion = f"{theme}_{emotion}"
#     sample = sample_dict[theme_emotion]
#     aspect = aspect_dict[theme]
    
#     prompt=f"""你是伊利乳制品公司的分析师，请对以下针对"对于这个新品的{theme}，你{emotion}的原因是什么？" ，的回答进行观点提取与打标。观点（只提炼{emotion}的点，要求语言精简明确，提炼核心主谓结构，去除标点、程度词、非必要修饰词），标签（即观点的评价维度，可以从<预设标签>中选择，也可自主提炼，无法提取设为未知），每个回答可包含一个或多个观点，输出时用|隔开。
# 按照"（标签，观点）"的格式输出每对观点和标签，不同观点用|隔开，不同回答用@隔开。请确保输出中不包含除指定格式外的其他文字。如果某个回答无法明确提取出观点或标签，则输出"（未知，未知）"

# ## 示例{sample}
# ## 内容
# <预设标签>：
# {aspect}

# <回答>：
# {answer}
# """
#     return prompt

def prompt_create(question, theme, emotion, answers):
    # theme_emotion = f"{theme}_{emotion}"
    # sample = sample_dict[theme_emotion]
    theme_specific = f"对于这个新品的{theme}，你{emotion}的原因是什么？" if theme != "其他设计" else f"{question}"
    emotion_specific = f'只提炼{emotion}的点。' if theme != "其他设计" else ""
    aspect = f'<预设标签>：\n{aspect_dict[theme]}\n\n' if theme != "其他设计" else ""
    
    prompt = f"""作为伊利乳制品公司的资深市场分析师，你的任务是针对问卷题目“{theme_specific}”的多个消费者回答进行深入的观点提取与精准打标。这对公司的产品改进和市场策略至关重要。

要求：
1. 整体分析：将每个回答视为一个完整的观点单元，不要过度拆分。
2. 观点提炼：
    - {emotion_specific}
    - 要求语言极致精简。
    - 提炼核心主谓结构，可保留必要的宾语或关键修饰词。
    - 去除标点、程度词、非必要修饰词。
    - 确保明确突出。
3. 标签分配：
    - {'优先从<预设标签>中选择最贴合的标签。如果预设标签不足以准确描述，再' if theme != "其他设计" else ''}自主创建准确、简洁的标签。
    - 标签应精准反映观点的核心评价维度。
    - {'如果实在无法提取明确的观点或分配合适的标签，使用"（未知，未知）"' if theme != "其他设计" else '如果回答与问题无关或表意不清，使用"（未知，未知）"'}。
4. 多维度分析：如果一个回答包含多个不同维度的观点，请分别列出所有相关的标签和观点对。
5. 语境理解：{'考虑产品类型和消费者可能的关注点，合理推断隐含的评价维度' if theme != "其他设计" else '严格对照问题内容，确保提取的观点与问题相关'}。

输出格式：
- 使用数字编号标识每个回答。
- 每个回答的观点和标签对使用"（标签，观点）"的格式。
- 同一回答的多个观点用"|"分隔。
- 不同回答用换行符分隔。

示例输出格式：
1. （口感，燕麦颗粒大）|（品质，产品新鲜）
2. （营养价值，富含蛋白质）
3. （未知，未知）

请记住，你的分析将直接影响产品开发和市场策略，务必保持专业、准确和洞察力。

## 内容
{aspect}<回答>：
{answers}
"""
    return prompt


def create_prompt_title(theme,emotion,answer_list):
    answer_text = "；".join(answer_list)
    theme_specific = f'针对"对于这个新品的{theme}，你{emotion}的原因是什么？"的' if theme != "其他设计" else ""
    report_type = "新品测试报告" if theme != "其他设计" else "市场研究报告"
    
    prompt_title = f"""你是专业的市场研究人员。{theme_specific}多个回答，已经进行了分类，以下的回答来自同一分类(不同回答用；隔开）：
"{answer_text}"
请为这些回答概括一个主题，要求语言精炼重点明确，此主题将用于撰写{report_type}(请直接输出主题，不要输出其他内容，不需要标点）"""
    return prompt_title