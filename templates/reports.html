{% extends "base.html" %}
{% block title %}报告中心 · 伊利智能 NPS 研究中心{% endblock %}
{% block header_title %}报告中心{% endblock %}
{% block header_desc %}统一管理调研周期报告、行动方案与总结，支撑跨部门复盘。{% endblock %}
{% block content %}
  <section class="card p-6">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg font-semibold text-slate-900">最新分析报告</h2>
      <a href="/api/reports" class="text-xs text-blue-600">查看 JSON 数据 →</a>
    </div>
    <p class="text-xs text-slate-500 mb-4">包含渠道、品类、创新项目等专题报告，可用于定期例会与复盘；所有内容遵循 <a href="/documents" class="text-blue-600 underline decoration-dotted">NPS 分析方法论</a> 中的指标与框架。</p>
    <div class="grid gap-4 md:grid-cols-2">
      {% for r in reports %}
      <div class="rounded-xl border border-slate-100 bg-white p-5 shadow-sm">
        <div class="flex items-start justify-between">
          <div>
            <h3 class="font-semibold text-slate-900">{{ r.title }}</h3>
            <p class="text-sm text-slate-500 mt-1">{{ r.description }}</p>
            <p class="text-[11px] text-slate-400 mt-2">{{ r.category }} · {{ r.date }} · {{ r.pages }} 页</p>
          </div>
          <span class="badge {{ 'bg-emerald-100 text-emerald-700' if r.status=='已完成' else 'bg-amber-100 text-amber-700' }}">{{ r.status }}</span>
        </div>
        <div class="mt-4 flex items-center space-x-3 text-xs">
          <a class="text-blue-600" href="/reports/{{ r.id }}">查看详情</a>
          <span class="text-slate-300">|</span>
          <a class="text-slate-600" href="#">下载 HTML</a>
        </div>
      </div>
      {% endfor %}
      {% if reports|length == 0 %}
      <p class="text-sm text-slate-500">暂无报告，上传或生成新报告后将在此处展示。</p>
      {% endif %}
    </div>
  </section>

  <section class="card p-6">
    <h3 class="text-lg font-semibold text-slate-900 mb-2">生成结论（v0兼容）</h3>
    <p class="text-xs text-slate-500 mb-4">将 NPS 指标 JSON 粘贴到下方，系统将生成中文要点总结（最后一条以“总体来看”开头）。</p>
    <form hx-post="/ui/reports/generate" hx-target="#report-result" hx-swap="innerHTML">
      <textarea name="metrics_text" class="w-full h-40 rounded-lg border border-slate-200 p-3 text-sm" placeholder='{"count":35,"nps_value":-0.3714,"user_distribution":[{"score":0,"people_number":3,"percentage":0.09},{"score":10,"people_number":6,"percentage":0.17}],"analysis_type_list":[{"type_name":"推荐者","type_percentage":0.23},{"type_name":"中立者","type_percentage":0.17},{"type_name":"贬损者","type_percentage":0.60}]}'></textarea>
      <button type="submit" class="mt-3 inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-xs font-medium text-white hover:bg-blue-500">生成结论</button>
    </form>
    <div id="report-result" class="mt-4 text-sm text-slate-700"></div>
  </section>
{% endblock %}
